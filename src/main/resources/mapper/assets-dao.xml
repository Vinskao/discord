<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mli.assetmybatis.dao.AssetsDAO">

    <resultMap id="assetsResultMap" type="com.mli.assetmybatis.model.Assets">
        <id property="id" column="id"/>
        <result property="assetNumber" column="asset_number"/>
        <result property="assetName" column="asset_name"/>
        <result property="userId" column="user_id"/>
        <result property="creationDate" column="creation_date" typeHandler="com.mli.assetmybatis.util.LocalDateTimeHandler"/>
        <result property="value" column="value"/>
        <result property="unitId" column="unit_id"/>
    </resultMap>

    <select id="findAll" resultMap="assetsResultMap">
        SELECT id, asset_number, asset_name, user_id, strftime('%Y-%m-%d %H:%M:%S.%f', creation_date) AS creation_date, value, unit_id FROM assets
    </select>

    <select id="findByAssetNumber" resultMap="assetsResultMap" parameterType="String">
        SELECT id, asset_number, asset_name, user_id, strftime('%Y-%m-%d %H:%M:%S.%f', creation_date) AS creation_date, value, unit_id FROM assets WHERE asset_number = #{assetNumber}
    </select>

    <insert id="insert" parameterType="com.mli.assetmybatis.model.Assets">
        INSERT INTO assets (asset_number, asset_name, user_id, creation_date, value, unit_id)
        VALUES (#{assetNumber}, #{assetName}, #{userId}, #{creationDate}, #{value}, #{unitId})
    </insert>

    <update id="update" parameterType="com.mli.assetmybatis.model.Assets">
        UPDATE assets
        SET asset_name = #{assetName}, user_id = #{userId}, creation_date = #{creationDate}, value = #{value}, unit_id = #{unitId}
        WHERE asset_number = #{assetNumber}
    </update>

    <delete id="delete" parameterType="String">
        DELETE FROM assets WHERE asset_number = #{assetNumber}
    </delete>

    <select id="selectByUnitId" resultMap="assetsResultMap" parameterType="int">
        SELECT id, asset_number, asset_name, user_id, strftime('%Y-%m-%d %H:%M:%S.%f', creation_date) AS creation_date, value, unit_id FROM assets WHERE unit_id = #{unitId}
    </select>

    <select id="getLastIdFromDatabase" resultType="int">
        SELECT MAX(id) AS last_id FROM assets
    </select>

    <select id="generateNewId" resultType="int">
        SELECT COALESCE(MAX(id), 0) + 1 AS new_id FROM assets
    </select>

</mapper>
